#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct node
{
    char name[20];
    char usn[20];
    char branch[20];
    int year;
    struct node *lptr, *rptr;
} NODE;

// Insert at beginning
NODE *ins_first(NODE *first)
{
    NODE *newnode = (NODE *)malloc(sizeof(NODE));
    if (newnode == NULL)
    {
        printf("Memory allocation failed.\n");
        return first;
    }

    printf("\nEnter the details of the student...\n");

    printf("Name: ");
    scanf("%19s", newnode->name);

    printf("USN: ");
    scanf("%19s", newnode->usn);

    printf("Branch: ");
    scanf("%19s", newnode->branch);

    printf("Year of admission: ");
    scanf("%d", &newnode->year);

    newnode->lptr = NULL;
    newnode->rptr = first;

    if (first != NULL)
        first->lptr = newnode;

    printf("New node inserted.\n");

    return newnode;
}

// Display based on branch
void display1(NODE *first)
{
    if (first == NULL)
    {
        printf("\nEmpty list");
        return;
    }

    char branch[20];
    int flag = 0;
    NODE *temp = first;

    printf("\nEnter the branch: ");
    scanf("%19s", branch);

    while (temp != NULL)
    {
        if (strcmp(temp->branch, branch) == 0)
        {
            if (flag == 0)
            {
                printf("\nList of students belonging to branch %s\n", branch);
                printf("Name\tUSN\tYear\n");
                flag = 1;
            }
            printf("%s\t%s\t%d\n", temp->name, temp->usn, temp->year);
        }
        temp = temp->rptr;
    }

    if (flag == 0)
        printf("\nNo student from branch %s\n", branch);
}

// Display all students
void display(NODE *first)
{
    if (first == NULL)
    {
        printf("\nEmpty list\n");
        return;
    }

    NODE *temp = first;
    printf("\nName\tUSN\tBranch\tYear\n");
    
    while (temp != NULL)
    {
        printf("%s\t%s\t%s\t%d\n", temp->name, temp->usn, temp->branch, temp->year);
        temp = temp->rptr;
    }
}

// Delete by USN
NODE *delete_specified_USN(NODE *first)
{
    if (first == NULL)
    {
        printf("List is empty\n");
        return first;
    }

    char key_usn[20];
    printf("Enter USN of student to delete: ");
    scanf("%19s", key_usn);

    NODE *temp = first;

    while (temp != NULL)
    {
        if (strcmp(key_usn, temp->usn) == 0)
        {
            // Case 1: first node
            if (temp == first)
            {
                first = temp->rptr;
                if (first != NULL)
                    first->lptr = NULL;

                printf("Deleted student with USN %s\n", temp->usn);
                free(temp);
                return first;
            }

            // Case 2: last node
            if (temp->rptr == NULL)
            {
                temp->lptr->rptr = NULL;
                printf("Deleted student with USN %s\n", temp->usn);
                free(temp);
                return first;
            }

            // Case 3: middle node
            temp->lptr->rptr = temp->rptr;
            temp->rptr->lptr = temp->lptr;

            printf("Deleted student with USN %s\n", temp->usn);
            free(temp);
            return first;
        }

        temp = temp->rptr;
    }

    printf("USN not found\n");
    return first;
}

int main()
{
    NODE *first = NULL;
    int choice;

    while (1)
    {
        printf("\n1: Add student\n2: Display by branch\n3: Display all\n4: Delete by USN\n5: Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        switch (choice)
        {
        case 1:
            first = ins_first(first);
            break;
        case 2:
            display1(first);
            break;
        case 3:
            display(first);
            break;
        case 4:
            first = delete_specified_USN(first);
            break;
        case 5:
            exit(0);
        default:
            printf("Invalid choice\n");
        }
    }
    return 0;
}
