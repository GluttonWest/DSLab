#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct EMPLOYEE
{
    int empid;
    char name[50];
    char dept[50];
    int salary;
    int age;
}e;

void add_record(FILE *fp)
{
    printf("\nEnter employee details\n");
    printf("ID: ");
    scanf("%d", &e.empid);
    printf("Name: ");
    scanf(" %[^\n]", e.name);
    printf("Department: ");
    scanf(" %[^\n]", e.dept);
    printf("Salary: ");
    scanf("%d", &e.salary);
    printf("Age: ");
    scanf("%d", &e.age);
    fprintf(fp, "%d\t%s\t%s\t%d\t%d\n",e.empid, e.name, e.dept, e.salary, e.age);
    printf("\nRecord saved\n");
}

void display_records(FILE *fp)
{
    printf("\nID\tNAME\t\tDEPT\t\tSALARY\tAGE\n");
    printf("-----------------------------------------------------------\n");
    while (fscanf(fp, "%d%s%s%d%d",&e.empid, e.name, e.dept, &e.salary, &e.age) != EOF){
        printf("%d\t%-10s\t%-10s\t%d\t%d\n",e.empid, e.name, e.dept, e.salary, e.age);
    }
}

void search_record(FILE *fp)
{
    char dept[50];
    int flag = 0;
    printf("\nEnter department to search: ");
    scanf(" %[^\n]", dept);
    while (fscanf(fp, "%d%s%s%d%d",&e.empid, e.name, e.dept, &e.salary, &e.age) != EOF)
    {
        if (strcmp(e.dept, dept) == 0){
            if (flag == 0){
                printf("\nSearch Successful!\n");
                printf("\nID\tNAME\t\tDEPT\t\tSALARY\tAGE\n");
                printf("-----------------------------------------------------------\n");
                flag = 1;
            }
            printf("%d\t%-10s\t%-10s\t%d\t%d\n",e.empid, e.name, e.dept, e.salary, e.age);
        }
    }
    if (flag == 0)
        printf("\nNo such record found!\n");
}

int main()
{
    FILE *fp;
    int choice;
    while (1)
    {
        printf("\n========= EMPLOYEE MANAGEMENT =========");
        printf("\n1. Add Record");
        printf("\n2. Search Record");
        printf("\n3. Display Records");
        printf("\n4. Exit");
        printf("\nEnter choice: ");
        scanf("%d", &choice);
        switch (choice)
        {
            case 1:
                fp = fopen("empfile.txt", "a");
                if (fp == NULL)
                {
                    printf("Error opening file!\n");
                    break;
                }
                add_record(fp);
                fclose(fp);
                break;

            case 2:
                fp = fopen("empfile.txt", "r");
                if (fp == NULL)
                {
                    printf("File not found!\n");
                    break;
                }
                search_record(fp);
                fclose(fp);
                break;

            case 3:
                fp = fopen("empfile.txt", "r");
                if (fp == NULL)
                {
                    printf("No records available!\n");
                    break;
                }
                display_records(fp);
                fclose(fp);
                break;

            case 4:
                exit(0);

            default:
                printf("Invalid choice!\n");
        }
    }
    return 0;
}
